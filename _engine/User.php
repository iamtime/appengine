<?php	class User extends Singleton{				public function onInit(){			if(self::isLogin()){				foreach($_SESSION['user'] as $k=>$v){					$this->$k = $v;				}			}		}				public function Auth($id,$data = array(),$token = false){			if(sizeof($data) < 1){				$data = db::selectq('SELECT * FROM users WHERE id = \''.$id.'\'');				$d = $data[0];			}else{				$d = $data;			}						$_SESSION['user'] = array(				'id'=>$d['id'],				'name'=>$d['username'],				'email'=>$d['email'],				'role_id'=>$d['role_id'],				'fio'=>(trim($d['fio']) ? $d['fio'] : $d['username']),				'phone'=>$d['phone'],				'avatar'=>$d['photo'],				'photo'=>$d['photo'],				'last_login'=>date('d.m.Y H:i',strtotime($d['_last_login'])),				'_last_ip'=>$d['_last_ip'],				'reg_date'=>date('d.m.Y H:i',strtotime($d['_created'])),				'info'=>$d['info'],			);						if($token){				$_SESSION['user']['token'] = $token;			}						foreach($_SESSION['user'] as $k=>$v){				$this->$k = $v;			}		}				public static function reSession(){			if(self::isLogin()){				self::i()->Auth(self::i()->id);			}			}				public static function isLogin($admin_check = true){			// unset($_SESSION['user']);			$check = false;						if(isset($_SESSION['user']) AND isset($_SESSION['user']['id'])){				if(!$admin_check){					if($_SESSION['user']['role_id'] == 0){						$check = true;					}				}else{					$check = true;				}							}						return $check; 		}				public static function isAdmLogin(){			if(self::isLogin(true)){				if($_SESSION['user']['role_id'] >= 1){					return true;				}			}						return false;		}				public static function logout(){			$ad = self::isAdmLogin();			unset($_SESSION['user']);			session_destroy();			header('Location: /'.($ad ? ADM_URL.'/' : ''));		}						public function checkUser($user_id = 0){			$user_id = (int)$user_id;			if($user_id == 0){				$user_id = $_SESSION['user']['id'];			}						$data = db::selectq('SELECT id FROM users WHERE id = \''.$user_id.'\'');						if(sizeof($data) > 0){				return true;			}			return false;		}				public static function getInfo($user_id = 0){			$user_id = (int)$user_id;			if($user_id == 0){				$user_id = $_SESSION['user']['id'];			}						$data = db::selectq('SELECT id,username,fio,avatar FROM users WHERE id = \''.$user_id.'\' AND status = 1');			if(sizeof($data) > 0){				return $data[0];			}			return false;		}						public static function getId(){			if(self::isLogin()){				return $_SESSION['user']['id'];			}else{				return 0;			}		}			}?>